function outputPosts(e,t){$.getJSON("http://api.neoseeker.com/threads/"+tId[1]+"/messages?start="+e+"&limit="+t+"&callback=?",function(e){var t=Math.round((new Date).getTime()/1e3);e.reverse();var n="<table style='width: 100%; border-collapse:collapse; table-layout: fixed;'>";if(typeof dateLimit!="undefined"){var r=(new Date(dateLimit)).getTime()}$.each(e,function(e,t){if(typeof r!="undefined"){var i=(new Date(t.created)).getTime();if(i>r){n+=__buildTableRow(e,t)}}else{n+=__buildTableRow(e,t)}});n+="</table>";$("#chatbox").html(n);$("#tiffyUpdatedTime").text("Last Update: Right now!");lastUpdateTime=t}).fail(function(e,t,n){$("#tiffyUpdatedTime").text("Error Loading - Still Trying to Update!");lastUpdateCache=0})}function __buildTableRow(e,t){var n=t.created_by.avatar_img.match(/[^\/]+$/);var r=new RegExp('<a.+class="mention".*>'+neousername+"</a>");var i=new RegExp("<blockquote>.+<a.+directmessage.php.+>"+neousername+"</a>.+</blockquote>");t.body=t.body.replace(/<iframe.+?src=\".+?embed\/([a-zA-Z0-9\-]+).+?<\/iframe>/g,"<a href='http://www.youtube.com/watch?v=$1' target='_blank'>YouTube Video</a>");if(r.test(t.body)||i.test(t.body)){var s="#ffff99"}else{var s=e%2?"#c6d0e7":"#eef0f9"}return"<tr style='width: 100%; background-color:"+s+"'><td style='text-align: center; width: 40px; border: 1px solid #fff;'><img src='http://i.neoseeker.com/m/s/"+n+"' /></td><td style='width: 100px; overflow: hidden; text-overflow:ellipsis; white-space:nowrap; border: 1px solid #fff; color: rgb(0, 51, 204);'><a href='#' onClick='addNotification(\""+t.created_by.username+"\"); return false;'>"+t.created_by.username+"</a></td><td style='border: 1px solid #fff;'>"+t.body+"</td><td style='width: 50px; text-align: center; border: 1px solid #fff;'><a style='border: 0;' onClick='tiffyQuickQuote("+t.forum.forumid+","+t.thread.threadid+","+t.messageid+");return false;' href='#'><img src='http://i.neoseeker.com/f/neo/replyquote.gif' /></a></td></tr>"}function checkForUpdate(){$.getJSON("http://api.neoseeker.com/threads/"+tId[1]+"?callback=?",function(e){var t=Math.round((new Date).getTime()/1e3);if(e.last_posted!=lastUpdateCache){lastUpdateCache=e.last_posted;e.num_posts<100?outputPosts(0,e.num_posts):outputPosts(e.num_posts-100,100)}else{$("#tiffyUpdatedTime").text("Last Update: "+(t-lastUpdateTime).toTextTimeOutputFormat())}});setTimeout("checkForUpdate()",3e3)}function tiffyPostToThread(){$("#livechatthreadsubmit").attr("disabled","disabled");var e=$("#tiffyChatBoxInput").val();var t=$("h1.threadtitle a:not(.label)").text()?"re: "+$("h1.threadtitle a:not(.label)").text():"nLive Post";var n=$.post("http://www.neoseeker.com/forums/index.php",{subject:t,body:e,fn:"post_reply",threadid:tId[1],submit:"true"});n.done(function(e){$("#tiffyChatBoxInput").val("");$("#tiffyChatBoxInput").height("2em");$("#livechatthreadsubmit").removeAttr("disabled")});return false}function addNotification(e){var t=$("#tiffyChatBoxInput").val();var n="@"+e;if(e.indexOf(" ")>=0){n+="@"}if(t.length&&!(/\s$/.test(t)||/\[\/quote\]$/.test(t))){t+=" "}$("#tiffyChatBoxInput").focus().val("").val(t+n+" ");$("#tiffyChatBoxInput").trigger("autosize")}function tiffyQuickQuote(e,t,n){var r=$.post("/forums/ajaxhandler.php",{act:"get_raw_msg_body",forumid:e,threadid:t,messageid:n});r.done(function(e){var t=$("#tiffyChatBoxInput").val();if(t.length){t+="\n\n"}$("#tiffyChatBoxInput").focus().val("").val(t+e);$("#tiffyChatBoxInput").trigger("autosize")})}function tiffySelectSmilie(e){var t=$("#tiffyChatBoxInput").val();e=/[^\S\n]$/.test(t)||!t.length?e:" "+e;$("#tiffyChatBoxInput").focus().val("").val(t+e);$("select#smilieselector").prop("selectedIndex",0);$("#tiffyChatBoxInput").trigger("autosize")}var tId=window.location.pathname.match(/\/t([0-9]+)/);var lastUpdateCache;var lastUpdateTime=Math.round((new Date).getTime()/1e3);var neousername=$("img.avatar").data("username");$(function(){$.getScript("https://cdn.staticneo.com/nfassets/js/plugins/jquery.autosize-min.js",function(){$("#tiffyChatBoxInput").autosize()});$.getScript("https://cdn.staticneo.com/nfassets/js/plugins/msdropdown/jquery.dd.min.js",function(){$("head").append('<link rel="stylesheet" href="https://cdn.staticneo.com/nfassets/js/plugins/msdropdown/dd.css" type="text/css" />');$("select#smilieselector").msDropDown()});var e=[[":)","https://cdn.staticneo.com/neoassets/smileys/smile.gif"],[":P","https://cdn.staticneo.com/neoassets/smileys/a_tongue.gif"],[";)","https://cdn.staticneo.com/neoassets/smileys/wink.gif"],[":(","https://cdn.staticneo.com/neoassets/smileys/sad.gif"],[":|","https://cdn.staticneo.com/neoassets/smileys/nosmile.gif"],[";(","https://cdn.staticneo.com/neoassets/smileys/cry.gif"],[":D","https://cdn.staticneo.com/neoassets/smileys/bigsmile.gif"],[":confused:","https://cdn.staticneo.com/neoassets/smileys/confused.gif"],[":cool:","https://cdn.staticneo.com/neoassets/smileys/cool.gif"],[":#","https://cdn.staticneo.com/neoassets/smileys/mad.gif"],[":o","https://cdn.staticneo.com/neoassets/smileys/embarrassed.gif"],["^_^","https://cdn.staticneo.com/neoassets/smileys/animesmile.gif"],[":colored:","https://cdn.staticneo.com/neoassets/smileys/coloredsmile.gif"],[":thick:","https://cdn.staticneo.com/neoassets/smileys/thicksmile.gif"],[":angry:","https://cdn.staticneo.com/neoassets/smileys/animangry.gif"],[":ashamed:","https://cdn.staticneo.com/neoassets/smileys/ashamed.gif"],[":hypno:","https://cdn.staticneo.com/neoassets/smileys/hypno.gif"],[":_puke:","https://cdn.staticneo.com/neoassets/smileys/puke.gif"],[":sonic:","https://cdn.staticneo.com/neoassets/smileys/sonic.gif"],[":sonicshadow:","https://cdn.staticneo.com/neoassets/smileys/sonicshadow.gif"],["o_O","https://cdn.staticneo.com/neoassets/smileys/huh.gif"],[":laugh:","https://cdn.staticneo.com/neoassets/smileys/a_laugh.gif"],[":angelwings:","https://cdn.staticneo.com/neoassets/smileys/angelwings.gif"],[":_devil2:","https://cdn.staticneo.com/neoassets/smileys/devil2.gif"],[":angel:","https://cdn.staticneo.com/neoassets/smileys/angel.gif"],[":blackeye:","https://cdn.staticneo.com/neoassets/smileys/blackeye.gif"],[":_dead:","https://cdn.staticneo.com/neoassets/smileys/dead.gif"],[":_devil:","https://cdn.staticneo.com/neoassets/smileys/devil.gif"],[":eating:","https://cdn.staticneo.com/neoassets/smileys/eating.gif"],[":_phantom:","https://cdn.staticneo.com/neoassets/smileys/phantom.gif"],[":rainbow:","https://cdn.staticneo.com/neoassets/smileys/rainbow.gif"],[":sleeping:","https://cdn.staticneo.com/neoassets/smileys/sleeping.gif"],[":annoyed:","https://cdn.staticneo.com/neoassets/smileys/annoyed.gif"],["o.O","https://cdn.staticneo.com/neoassets/smileys/oO.gif"],[":_dumbfounded:","https://cdn.staticneo.com/neoassets/smileys/dumbfounded.gif"],["¬_¬","https://cdn.staticneo.com/neoassets/smileys/closed_eyes.gif"],[":blinkeyes:","https://cdn.staticneo.com/neoassets/smileys/blinky_eyes.gif"],[":rolleyes:","https://cdn.staticneo.com/neoassets/smileys/rolleyes.gif"],[":moony:","https://cdn.staticneo.com/neoassets/smileys/moony.gif"],[":_oooh:","https://cdn.staticneo.com/neoassets/smileys/oooh.gif"],[":shifty:","https://cdn.staticneo.com/neoassets/smileys/shifty.gif"],[":_oops:","https://cdn.staticneo.com/neoassets/smileys/oops.gif"],[":notamused:","https://cdn.staticneo.com/neoassets/smileys/notamused.gif"],[":whatever:","https://cdn.staticneo.com/neoassets/smileys/whatever.gif"],[":suikiasmile:","https://cdn.staticneo.com/neoassets/smileys/suikia_smiley.gif"],[":coolcat:","https://cdn.staticneo.com/neoassets/smileys/coolcat.gif"],[":lock:","https://cdn.staticneo.com/neoassets/smileys/lock.gif"],[":redanger:","https://cdn.staticneo.com/neoassets/smileys/redanger.gif"],[":frag:","https://cdn.staticneo.com/neoassets/smileys/redfrag.gif"],[":skully8:","https://cdn.staticneo.com/neoassets/smileys/skully8ball.png"],[":epic:","https://cdn.staticneo.com/neoassets/smileys/epic.gif"],[":bigfrown:","https://cdn.staticneo.com/neoassets/smileys/bigfrown.gif"],[":happy:","https://cdn.staticneo.com/neoassets/smileys/reallyhappy.gif"],[":salty:","https://cdn.staticneo.com/neoassets/smileys/salty.gif"],[":shocked:","https://cdn.staticneo.com/neoassets/smileys/shocked.gif"],[":_pointy2:","https://cdn.staticneo.com/neoassets/smileys/pointy2.gif"],[":XD;","https://cdn.staticneo.com/neoassets/smileys/xd.gif"],[":nothappy:","https://cdn.staticneo.com/neoassets/smileys/nothappy.gif"],[":ninja:","https://cdn.staticneo.com/neoassets/smileys/ninja.gif"],[":shroom:","https://cdn.staticneo.com/neoassets/smileys/shroom.gif"],[":1up:","https://cdn.staticneo.com/neoassets/smileys/1up.gif"],[":kirby:","https://cdn.staticneo.com/neoassets/smileys/kirby.gif"],[":_pokeball:","https://cdn.staticneo.com/neoassets/smileys/pokeball.gif"],[":yoshi:","https://cdn.staticneo.com/neoassets/smileys/yoshi.gif"],[":samus:","https://cdn.staticneo.com/neoassets/smileys/samus.gif"],[":snake:","https://cdn.staticneo.com/neoassets/smileys/snake.gif"],["<3;","https://cdn.staticneo.com/neoassets/smileys/heart.gif"],["</3;","https://cdn.staticneo.com/neoassets/smileys/brokenheart.gif"],[":yinyang:","https://cdn.staticneo.com/neoassets/smileys/yinyang.gif"],[":triforce:","https://cdn.staticneo.com/neoassets/smileys/triforce.gif"],[":mario:","https://cdn.staticneo.com/neoassets/smileys/mario.gif"],[":luigi:","https://cdn.staticneo.com/neoassets/smileys/luigi.gif"],[":holymateria:","https://cdn.staticneo.com/neoassets/smileys/holymateria.gif"],[":meteormateria:","https://cdn.staticneo.com/neoassets/smileys/meteormateria.gif"],[":_pointy1:","https://cdn.staticneo.com/neoassets/smileys/pointy1.gif"],[":_dragoniteballz:","https://cdn.staticneo.com/neoassets/smileys/yeahbaby.gif"]];var t="<select onChange='tiffySelectSmilie(this.value)' style='width: 100px;' name='tiffychatsmilies' id='smilieselector'>";t+="<option value=''>--smilies--</option>";for(n=0;n<e.length;n++){t+="<option value='"+e[n][0]+"' data-image='"+e[n][1]+"'></option>"}t+="</select>";var r="<div style='clear: both; margin-left: auto; margin-right: auto;' id='chatparentcontainer'><p style='color: #fff; font-size: 12px; font-weight: bold; margin-left: auto; margin-right: auto; width: 80%; background-color: #336699;'>nLive Chat<span id='tiffyUpdatedTime' style='float: right;'></span></p><div id='chatbox' style='resize: both; margin-left: auto; margin-right: auto; width: 80%; height: 400px; overflow-x: hidden; overflow-y: scroll;'></div><form onsubmit='return tiffyPostToThread();'><p style='text-align: center;'><textarea style='width: 80%; height: 2em;' id='tiffyChatBoxInput'></textarea><br /><input id='livechatthreadsubmit' value='Send to Chat' type='submit' />&nbsp;"+t+"</p></form></div>";$(r).insertAfter("h1.threadtitle");checkForUpdate()});Number.prototype.toTextTimeOutputFormat=function(){var e=parseInt(this,10);var t=Math.floor(e/3600);var n=Math.floor((e-t*3600)/60);var r=e-t*3600-n*60;if(n==0){var i=r+" seconds ago"}else if(t==0){var i=n+(n>1?" minutes, ":" minute, ")+r+" seconds ago"}else{var i=t+(t>1?" hours, ":" hour, ")+n+(n>1?" minutes, ":" minute, ")+r+" seconds ago"}return i}
